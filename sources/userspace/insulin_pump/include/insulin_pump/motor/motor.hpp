// ---------------------------------------------------------------------------------------------------------------------
/// \file motor.hpp
/// \date 19. 03. 2023
/// \author Jaroslav Rosa (rosajaro1352@gmail.com)
///
/// \brief This file defines a class of Motor for Insulin Pump
// ---------------------------------------------------------------------------------------------------------------------

#pragma once

// STL imports (excluded from Doxygen)
/// \cond
//#include <cstdint>
#include "motor.h"
/// \endcond

// Project file imports

#include "../../insulin_pump/definitions/definitions.hpp"
#include "../../utils/logger/logger.hpp"

#define GIVING_DOSE_NOTIFICATION "Podavam davku "

// -----------------------------------------------------------------------------------------------------------------
/// \class Insulin_Pump
/// \brief 
///
/// 
// -----------------------------------------------------------------------------------------------------------------
class Motor
{
public:

	// -------------------------------------------------------------------------------------------------------------
	/// \brief Creates an instance of the class.
	// -------------------------------------------------------------------------------------------------------------
	Motor();

	// -------------------------------------------------------------------------------------------------------------
	/// \brief Destroys (deletes) the object from the memory.
	// -------------------------------------------------------------------------------------------------------------
	~Motor();

	// -------------------------------------------------------------------------------------------------------------
	/// \brief Initialize motor before run
	///
	/// 
	///
	// -------------------------------------------------------------------------------------------------------------
	void Initialize();

	// -------------------------------------------------------------------------------------------------------------
	/// \brief Tests the motor
	///
	/// 
	///
	// -------------------------------------------------------------------------------------------------------------
	bool Test();

	// -------------------------------------------------------------------------------------------------------------
	/// \brief Gives dose of insulin in mls
	///
	/// 
	///
	// -------------------------------------------------------------------------------------------------------------
	void Give_Dose(uint16_t ml);

private:

	// -------------------------------------------------------------------------------------------------------------
	/// \brief Translates mililiters to micro revolutions of motor
	///
	/// 
	///
	// -------------------------------------------------------------------------------------------------------------
	uint32_t Ml_To_Revolutions(uint16_t ml);

	// -------------------------------------------------------------------------------------------------------------
	/// \brief Gives dose of insulin in number of micro revolutions
	///
	/// 
	///
	// -------------------------------------------------------------------------------------------------------------
	void Give_Dose(uint32_t revolutions);

	// -------------------------------------------------------------------------------------------------------------
	/// \brief Moves motor by defined number of micro revolutions back
	///
	/// 
	///
	// -------------------------------------------------------------------------------------------------------------
	void Move_Back();

	uint32_t m_micro_revolutions_counter = 0; ///<

	uint32_t m_units_given = 0; ///<

	CMotor m_motor;
};
